#!/usr/bin/env ruby
# frozen_string_literal: true

$LOAD_PATH.unshift(File.expand_path('../lib', __dir__))

require 'shellwords'
require 'optparse'

require 'rspectre'

options = { rspec: %w[spec], autocorrect: false }

OptionParser.new do |opts|
  opts.banner = 'Usage: rspectre [options]'

  opts.on('--rspec RSPEC_ARGS', 'Arguments to feed to RSpec.') do |value|
    options[:rspec] = value.shellsplit
  end

  opts.on(
    '--autocorrect',
    'Enables autocorrect.',
    'When autocorrect is enabled, rspectre will modify your source files in place and delete any'\
    ' unused test setup.'
  ) do |value|
    options[:autocorrect] = value
  end
end.parse(ARGV)

rspec, autocorrect = options.fetch_values(:rspec, :autocorrect)

RSpectre::Runner.new(rspec, autocorrect).lint
